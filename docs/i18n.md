# Internationalization (I18N)

This guide explains the multi-language support system in CrossPoint Reader.

## Supported Languages (Updating)

### English (Default)

The default language. All text is displayed in English.

Full translation including:
- All menu items and settings
- System messages and prompts
- Button labels and hints
- Error messages

---


## For Developers

### Translation System Architecture

The I18N system uses a **CSV-based workflow** to maintain translations and automatically generate code:

```
scripts/
├── translations.csv          # Single source of truth for all translations
└── generate_i18n.py         # Code generator script

lib/I18n/
├── I18n.h                   # Header (manual class)
├── I18n.cpp                 # Implementation (manual)
├── I18nKeys.h               # Enums (auto-generated)
├── I18nStrings.h            # String array declarations (auto-generated)
└── I18nStrings.cpp          # String array definitions (auto-generated)
```

**Key principle:** All translations are managed in `translations.csv`. The Python script generates the necessary C++ code automatically.

---

### CSV File Format

The `scripts/translations.csv` file contains all translatable strings:


**Columns:**
- `KEYS`: Unique identifier used in C++ code (e.g., `BROWSE_FILES`)
- `ENGLISH`: English translation
- `SPANISH`: Spanish translation
- `ITALIAN`: Italian translation
- `SWEDISH`: Swedish translation
- `FRENCH`: French translation
- etc

**CSV Rules:**
- Use UTF-8 encoding
- Keys must be valid C++ identifiers (uppercase, underscores only)
- Keys must be unique
- All language columns must have a value (use the English text as fallback if no translation exists)
- Keep translations concise for E-ink display constraints

---

### Adding New Strings

To add a new translatable string:

#### 1. Edit `scripts/translations.csv`

Add a new row with translations for all languages:

```csv
key,en,es,it,sv,fr,context
MY_NEW_STRING,My New String,Mi nueva cadena,La mia nuova stringa,Min nya sträng,Ma nouvelle chaîne,Settings
```

#### 2. Run the generator script

```bash
python3 scripts/generate_i18n.py
```

This automatically:
- Updates the `StrId` enum in `lib/I18n/I18n.h`
- Regenerates all language arrays in `lib/I18n/I18nStrings.cpp`
- Validates that all translations are present
- Reports any issues (missing translations, duplicate keys, etc.)

#### 3. Use in code

```cpp
#include <I18n.h>

// Using the i18n() macro (recommended)
renderer.drawText(font, x, y, i18n(MY_NEW_STRING));

// Using I18N.get() directly
const char* text = I18N.get(StrId::MY_NEW_STRING);
```

**That's it!** No manual array synchronization needed.

---

### Adding a New Language

To add support for a new language (e.g., German):

#### 1. Update `scripts/translations.csv`

Add a new column for the language:

#### 2. Run the generator

```bash
python3 scripts/generate_i18n.py
```

This automatically Updates all necessary code

---

### Modifying Existing Translations

Simply edit the CSV file and regenerate:

---

### UTF-8 Encoding

The CSV file uses UTF-8 encoding. Special characters are automatically converted to C++ UTF-8 hex sequences by the generator.

**In CSV:** (plain UTF-8 text)
```csv
SETTINGS_TITLE,Settings,Configuración,Impostazioni,Inställningar,Paramètres,Settings
```

**Generated C++:** (automatic hex encoding)
```cpp
"Configuraci\xC3\xB3n",  // Spanish ó is encoded
"Inställningar",          // Swedish ä is encoded
"Paramètres",             // French è is encoded
```

You don't need to manually encode anything—just use normal text in the CSV.

---

### I18N API Reference

```cpp
// === Convenience Macros (Recommended) ===

// i18n(id) - Get translated string without StrId:: prefix
const char* text = i18n(SETTINGS_TITLE);
renderer.drawText(font, x, y, i18n(BROWSE_FILES));
Serial.printf("Status: %s\n", i18n(CONNECTED));

// I18N - Shorthand for I18n::getInstance()
I18N.setLanguage(Language::SPANISH);
Language lang = I18N.getLanguage();

// === Full API ===

// Get the singleton instance
I18n& instance = I18n::getInstance();

// Get translated string (three equivalent ways)
const char* text = i18n(SETTINGS_TITLE);              // Macro (recommended)
const char* text = I18N.get(StrId::SETTINGS_TITLE);   // Direct call
const char* text = I18N[StrId::SETTINGS_TITLE];       // Operator overload

// Set language
I18N.setLanguage(Language::SPANISH);

// Get current language
Language lang = I18N.getLanguage();

// Save language setting to file
I18N.saveSettings();

// Load language setting from file
I18N.loadSettings();

// Get character set for font subsetting (static method)
const char* chars = I18n::getCharacterSet(Language::FRENCH);
```

---

## File Storage

Language settings are stored in:
```
/.crosspoint/language.bin
```

This file contains:
- Version byte
- Current language selection (1 byte)

---

## Translation Workflow

### For Developers (Adding Features)

1. Add new strings to `scripts/translations.csv` with English text
2. Use placeholder text for other languages (copy English temporarily)
3. Run `python3 scripts/generate_i18n.py`
4. Use the new `StrId` in your code
5. Request translations from translators

### For Translators

1. Open `scripts/translations.csv` in Excel, Google Sheets, or a text editor
2. Translate missing entries for your language column
3. Keep translations concise (E-ink space constraints)
4. Save the file in UTF-8 encoding
5. Test on device or submit for review


## **Golden Rule:** Only edit translations.csv. Everything else is generated or manual implementation.